<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple 3D Test</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
        #info { background: white; padding: 15px; margin-bottom: 20px; }
        #container { width: 100%; height: 600px; background: #e0e0e0; }
        #log { background: #263238; color: #aed581; padding: 15px; margin-top: 20px;
               font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div id="info">
        <h2>Simple 3D Model Test</h2>
        <p>Status: <strong id="status">Loading libraries...</strong></p>
    </div>
    <div id="container"></div>
    <div id="log"></div>

    <!-- Load Three.js from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        const log = document.getElementById('log');
        const statusEl = document.getElementById('status');

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ef5350' : type === 'success' ? '#66bb6a' : '#aed581';
            log.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            log.scrollTop = log.scrollHeight;
            console.log(message);
        }

        // Check if Three.js loaded
        if (typeof THREE === 'undefined') {
            addLog('ERROR: Three.js failed to load', 'error');
            statusEl.textContent = 'Failed to load Three.js!';
        } else {
            addLog('Three.js loaded successfully', 'success');
            statusEl.textContent = 'Setting up scene...';

            try {
                const container = document.getElementById('container');

                // Scene
                const scene = new THREE.Scene();
                scene.background = new THREE.Color(0xe0e0e0);
                addLog('Scene created');

                // Camera
                const camera = new THREE.PerspectiveCamera(
                    50,
                    container.clientWidth / container.clientHeight,
                    0.1,
                    1000
                );
                camera.position.set(4, 3, 6);
                addLog('Camera created');

                // Renderer
                const renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(container.clientWidth, container.clientHeight);
                container.appendChild(renderer.domElement);
                addLog('Renderer created', 'success');

                // Lights
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
                scene.add(ambientLight);
                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 10, 5);
                scene.add(directionalLight);
                addLog('Lights added');

                // Controls
                const controls = new THREE.OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.autoRotate = true;
                addLog('Controls initialized');

                // Ground plane
                const groundGeometry = new THREE.PlaneGeometry(20, 20);
                const groundMaterial = new THREE.MeshStandardMaterial({ color: 0xcccccc });
                const ground = new THREE.Mesh(groundGeometry, groundMaterial);
                ground.rotation.x = -Math.PI / 2;
                ground.position.y = -0.5;
                scene.add(ground);
                addLog('Ground added');

                // Animation loop
                function animate() {
                    requestAnimationFrame(animate);
                    controls.update();
                    renderer.render(scene, camera);
                }
                animate();
                addLog('Animation started', 'success');

                statusEl.textContent = 'Testing file access...';

                // Test if GLTF file exists
                addLog('Testing GLTF file access...');
                fetch('/models/forklift/ForkliftElecrtic.gltf')
                    .then(response => {
                        addLog(`Response: ${response.status} ${response.statusText}`);
                        addLog(`Content-Type: ${response.headers.get('content-type')}`);

                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        return response.text();
                    })
                    .then(text => {
                        addLog(`File accessible! Size: ${text.length} bytes`, 'success');
                        statusEl.textContent = 'Loading 3D model...';

                        // Now load with GLTFLoader
                        const loader = new THREE.GLTFLoader();

                        loader.load(
                            '/models/forklift/ForkliftElecrtic.gltf',
                            function(gltf) {
                                addLog('GLTF loaded successfully!', 'success');
                                statusEl.textContent = 'Model loaded! âœ“';

                                const model = gltf.scene;

                                // Center and scale
                                const box = new THREE.Box3().setFromObject(model);
                                const size = box.getSize(new THREE.Vector3());
                                addLog(`Model size: ${size.x.toFixed(2)} x ${size.y.toFixed(2)} x ${size.z.toFixed(2)}`);

                                const maxDim = Math.max(size.x, size.y, size.z);
                                const scale = 2.5 / maxDim;
                                model.scale.multiplyScalar(scale);

                                const center = box.getCenter(new THREE.Vector3());
                                model.position.sub(center.multiplyScalar(scale));
                                model.position.y = 0;

                                scene.add(model);
                                addLog('Model added to scene!', 'success');
                            },
                            function(xhr) {
                                const percent = (xhr.loaded / xhr.total * 100).toFixed(0);
                                addLog(`Loading: ${percent}%`);
                            },
                            function(error) {
                                addLog(`ERROR loading model: ${error}`, 'error');
                                statusEl.textContent = 'Error loading model!';
                                console.error(error);
                            }
                        );
                    })
                    .catch(error => {
                        addLog(`ERROR accessing file: ${error}`, 'error');
                        statusEl.textContent = 'File not accessible!';
                    });

            } catch (error) {
                addLog(`ERROR: ${error}`, 'error');
                statusEl.textContent = 'Setup failed!';
                console.error(error);
            }
        }
    </script>
</body>
</html>
