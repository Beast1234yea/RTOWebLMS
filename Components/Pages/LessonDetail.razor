@page "/lesson/{lessonId}"
@using Microsoft.EntityFrameworkCore
@using RTOWebLMS.Data
@using RTOWebLMS.Models
@inject LmsDbContext DbContext
@inject NavigationManager Navigation
@rendermode InteractiveServer

<PageTitle>@(lesson?.Title ?? "Lesson") - RTO LMS</PageTitle>

@if (lesson == null)
{
    <div class="text-center p-5">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>
}
else
{
    <div class="container my-4">
        <!-- Header with Gradient -->
        <div class="lesson-header mb-4">
            <h1 class="lesson-title">@lesson.Title</h1>

            <div class="d-flex gap-3 flex-wrap">
                <div class="badge-container">
                    <span class="time-icon">‚è±</span>
                    <span class="duration-text">Duration: @(lesson.Duration > 0 ? $"{lesson.Duration} min" : "Not specified")</span>
                </div>

                @if (isCompleted)
                {
                    <div class="completed-badge">
                        <span>‚úì COMPLETED</span>
                    </div>
                }
            </div>
        </div>

        <!-- Images Slideshow Section -->
        @if (lessonMedia.Any())
        {
            <div class="media-section mb-4">
                <div class="section-header section-header-purple">
                    <span>üì∏ LESSON MEDIA</span>
                </div>

                <div class="slideshow-container">
                    <div class="image-display">
                        <img src="@lessonMedia[currentImageIndex].FilePath"
                             alt="Lesson media @(currentImageIndex + 1)"
                             class="img-fluid" />
                    </div>

                    <div class="slideshow-controls mt-3">
                        <button class="btn btn-nav"
                                disabled="@(currentImageIndex == 0)"
                                @onclick="PreviousImage">
                            ‚Üê Previous
                        </button>

                        <span class="image-counter">
                            @(currentImageIndex + 1) / @lessonMedia.Count
                        </span>

                        <button class="btn btn-nav"
                                disabled="@(currentImageIndex >= lessonMedia.Count - 1)"
                                @onclick="NextImage">
                            Next ‚Üí
                        </button>
                    </div>

                    @if (!string.IsNullOrEmpty(lessonMedia[currentImageIndex].Caption))
                    {
                        <p class="image-caption mt-2">@lessonMedia[currentImageIndex].Caption</p>
                    }
                </div>
            </div>
        }

        <!-- Forklift Introduction Section (appears first for forklift lessons) -->
        @if (lesson.Title != null && lesson.Title.ToLower().Contains("forklift"))
        {
            <div class="content-section mb-4">
                <div class="section-header section-header-teal">
                    <span>üìñ INTRODUCTION</span>
                </div>

                <div class="lesson-content">
                    <h3 class="text-primary fw-bold mb-3">1.1 INTRODUCTION</h3>
                    <p>This training course is based on the National High Risk Licence Units of Competence <strong>TLILIC0003 Licence To Operate A Forklift Truck</strong></p>

                    <p>The National Standard for Licensing Persons Performing High Risk Work aims to facilitate the operation of a nationally uniform, competency-based licensing system for persons performing certain types of high risk work.</p>

                    <p>The National Standard recognises the importance of quality training as an underpinning principle in providing skilled workers, and that the most effective form of training is a combination of informal and formal training methods. It requires training and assessment to be undertaken by a Registered Training Organisation (RTO).</p>

                    <h4 class="text-primary fw-bold mt-4 mb-3">You will learn about:</h4>
                    <ul class="list-unstyled">
                        <li class="mb-2">‚úì Planning and preparing for operations.</li>
                        <li class="mb-2">‚úì Conducting pre-operational and post-operational checks.</li>
                        <li class="mb-2">‚úì Attaching, securing, lifting, carrying and placing materials and loads.</li>
                        <li class="mb-2">‚úì Conducting Post-Operational Checks</li>
                        <li class="mb-2">‚úì Park up procedure.</li>
                    </ul>

                    <h3 class="text-primary fw-bold mt-5 mb-3">WHAT IS A FORKLIFT?</h3>
                    <p class="lead">A forklift is a powered industrial truck equipped with a mast and an elevating load carriage to which is attached a pair of fork arms or another attachment.</p>

                    <h3 class="text-primary fw-bold mt-5 mb-3">PARTS OF A FORKLIFT</h3>
                    <p>It is important that you understand the different parts and controls of a forklift. Below is a diagram outlining some important parts of a forklift:</p>

                    <div class="parts-list mt-4 p-4 bg-light rounded">
                        <h5 class="text-primary mb-3">KEY COMPONENTS:</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><strong>A.</strong> Forks/Tynes</li>
                                    <li class="mb-2"><strong>B.</strong> Load Backrest</li>
                                    <li class="mb-2"><strong>C.</strong> Carriage</li>
                                    <li class="mb-2"><strong>D.</strong> Mast</li>
                                    <li class="mb-2"><strong>E.</strong> Hydraulic Lift Ram</li>
                                    <li class="mb-2"><strong>F.</strong> Overhead Guard</li>
                                    <li class="mb-2"><strong>G.</strong> Lights & Horn</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2"><strong>H.</strong> Steering and Lever Controls</li>
                                    <li class="mb-2"><strong>I.</strong> Hydraulic Tilt Ram</li>
                                    <li class="mb-2"><strong>J.</strong> Drive Wheels</li>
                                    <li class="mb-2"><strong>K.</strong> Rear/Steering Wheels</li>
                                    <li class="mb-2"><strong>L.</strong> Counter Balance</li>
                                    <li class="mb-2"><strong>M.</strong> Operator's Seat</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Learner Guide Table of Contents -->
            <div class="content-section mb-4">
                <div class="section-header section-header-gradient">
                    <span>üìö LEARNER GUIDE CONTENTS</span>
                </div>

                <div class="lesson-content">
                    <div class="toc-container">
                        <!-- PART 1 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 1</span>
                                <span class="part-title">WORKPLACE HEALTH AND SAFETY</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 1: Understanding Hazards and Risks</div>
                                <div class="toc-chapter">Chapter 2: Your Duties as a Worker</div>
                                <div class="toc-chapter">Chapter 3: Employer Responsibilities</div>
                                <div class="toc-chapter">Chapter 4: Consequences of Unsafe Work</div>
                            </div>
                        </div>

                        <!-- PART 2 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 2</span>
                                <span class="part-title">PLANNING AND PREPARING FOR WORK</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 5: Identifying Task Requirements</div>
                                <div class="toc-chapter">Chapter 6: Assessing the Work Area</div>
                                <div class="toc-chapter">Chapter 7: Planning Safe Travel Paths</div>
                                <div class="toc-chapter">Chapter 8: Traffic Management</div>
                                <div class="toc-chapter">Chapter 9: Consultation and Communication</div>
                            </div>
                        </div>

                        <!-- PART 3 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 3</span>
                                <span class="part-title">FORKLIFT HAZARDS</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 10: Electrical Hazards and Powerlines</div>
                                <div class="toc-chapter">Chapter 11: Pedestrian Safety</div>
                                <div class="toc-chapter">Chapter 12: Environmental Conditions</div>
                            </div>
                        </div>

                        <!-- PART 4 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 4</span>
                                <span class="part-title">FORKLIFT EQUIPMENT AND CHECKS</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 13: Pre-Start Inspections</div>
                                <div class="toc-chapter">Chapter 14: Accessing the Forklift Safely</div>
                                <div class="toc-chapter">Chapter 15: Logbooks and Record Keeping</div>
                                <div class="toc-chapter">Chapter 16: Operational Checks</div>
                                <div class="toc-chapter">Chapter 17: Forklift Guards and Safety Features</div>
                            </div>
                        </div>

                        <!-- PART 5 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 5</span>
                                <span class="part-title">ATTACHMENTS AND LOAD CAPACITY</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 18: Understanding Load Capacity</div>
                                <div class="toc-chapter">Chapter 19: Forklift Attachments</div>
                                <div class="toc-chapter">Chapter 20: Data Plates and Load Centres</div>
                            </div>
                        </div>

                        <!-- PART 6 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 6</span>
                                <span class="part-title">SAFE OPERATING PROCEDURES</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 21: Determining Load Weight</div>
                                <div class="toc-chapter">Chapter 22: Load Handling Techniques</div>
                                <div class="toc-chapter">Chapter 23: Traveling with Loads</div>
                                <div class="toc-chapter">Chapter 24: Stacking and Placing Loads</div>
                                <div class="toc-chapter">Chapter 25: Preventing Tip-Overs</div>
                            </div>
                        </div>

                        <!-- PART 7 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 7</span>
                                <span class="part-title">EMERGENCY RESPONSE</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 26: Equipment Failures</div>
                                <div class="toc-chapter">Chapter 27: Powerline Contact Procedures</div>
                                <div class="toc-chapter">Chapter 28: Responding to Unplanned Situations</div>
                            </div>
                        </div>

                        <!-- PART 8 -->
                        <div class="toc-part">
                            <div class="toc-part-header">
                                <span class="part-number">PART 8</span>
                                <span class="part-title">SHUTDOWN AND SECURITY</span>
                            </div>
                            <div class="toc-chapters">
                                <div class="toc-chapter">Chapter 29: Parking Procedures</div>
                                <div class="toc-chapter">Chapter 30: Securing the Forklift</div>
                            </div>
                        </div>

                        <!-- APPENDIX -->
                        <div class="toc-part toc-appendix">
                            <div class="toc-part-header">
                                <span class="part-number">APPENDIX</span>
                                <span class="part-title">Load Calculation Methods</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PART 1: WORKPLACE HEALTH AND SAFETY -->
            <div class="content-section mb-4">
                <div class="section-header section-header-part">
                    <span>‚ö†Ô∏è PART 1: WORKPLACE HEALTH AND SAFETY</span>
                </div>

                <div class="lesson-content">
                    <h3 class="text-primary fw-bold mb-4">CHAPTER 1: UNDERSTANDING HAZARDS AND RISKS</h3>

                    <p class="lead">Before you can operate a forklift safely, you must understand two fundamental concepts: hazards and risks.</p>

                    <div class="chapter-section mt-4">
                        <h4 class="text-primary fw-bold mb-3">What is a Hazard?</h4>

                        <p>A hazard is anything that has the potential to cause harm to a person. In the workplace, hazards are all around us, and recognizing them is the first step in preventing injuries.</p>

                        <div class="info-box bg-light p-4 rounded mt-3">
                            <h6 class="fw-bold text-primary mb-3">In forklift operations, common hazards include:</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="hazard-list">
                                        <li>Overhead power lines that could electrocute you</li>
                                        <li>Uneven or slippery floor surfaces</li>
                                        <li>Heavy loads that could fall</li>
                                        <li>Pedestrians walking in your operating area</li>
                                        <li>Poor visibility or inadequate lighting</li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="hazard-list">
                                        <li>Narrow aisles with limited clearance</li>
                                        <li>Defective or poorly maintained equipment</li>
                                        <li>Underground services like gas pipes or electrical cables</li>
                                        <li>Obstacles blocking your travel path</li>
                                        <li>Steep slopes or ramps</li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-warning mt-3">
                            <strong>Important:</strong> A hazard doesn't have to have caused harm yet. If something has the <strong>POTENTIAL</strong> to cause harm, it's a hazard. For example, a wet floor is a hazard even if nobody has slipped on it.
                        </div>
                    </div>

                    <div class="chapter-section mt-5">
                        <h4 class="text-primary fw-bold mb-3">What is a Risk?</h4>

                        <p>A risk is the chance or likelihood that harm will actually occur when you're exposed to a hazard. Risk takes into account both:</p>

                        <div class="risk-factors p-4 bg-light rounded mt-3 mb-3">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <div class="risk-factor-card">
                                        <div class="risk-number">1</div>
                                        <p class="mb-0"><strong>How likely</strong> is it that the harm will happen?</p>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <div class="risk-factor-card">
                                        <div class="risk-number">2</div>
                                        <p class="mb-0"><strong>How serious</strong> would the harm be if it did happen?</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <h5 class="text-primary fw-bold mt-4 mb-3">Understanding the relationship between hazards and risks:</h5>

                        <div class="concept-comparison p-4 rounded mb-4">
                            <div class="row text-center">
                                <div class="col-md-5">
                                    <div class="concept-box hazard-box p-3 rounded">
                                        <h6 class="fw-bold">HAZARD</h6>
                                        <p class="mb-0">The thing that could cause harm</p>
                                    </div>
                                </div>
                                <div class="col-md-2 d-flex align-items-center justify-content-center">
                                    <span class="fs-3 fw-bold text-muted">‚â†</span>
                                </div>
                                <div class="col-md-5">
                                    <div class="concept-box risk-box p-3 rounded">
                                        <h6 class="fw-bold">RISK</h6>
                                        <p class="mb-0">The chance that harm will occur</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-info">
                            <h6 class="fw-bold">Example:</h6>
                            <ul class="mb-0">
                                <li><strong>Hazard:</strong> Overhead power line near your work area</li>
                                <li><strong>Risk:</strong> High likelihood of electrocution if your forklift mast touches it, resulting in death or serious injury</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chapter-section mt-5">
                        <h4 class="text-primary fw-bold mb-3">Your role in managing hazards and risks:</h4>

                        <p class="mb-3">As a forklift operator, you must:</p>

                        <div class="responsibility-list">
                            <div class="responsibility-item">
                                <div class="responsibility-icon">1</div>
                                <div class="responsibility-content">
                                    <strong>Identify hazards</strong> in your work area before you start
                                </div>
                            </div>

                            <div class="responsibility-item">
                                <div class="responsibility-icon">2</div>
                                <div class="responsibility-content">
                                    <strong>Assess the level of risk</strong> each hazard presents
                                </div>
                            </div>

                            <div class="responsibility-item">
                                <div class="responsibility-icon">3</div>
                                <div class="responsibility-content">
                                    <strong>Implement control measures</strong> to reduce or eliminate risks
                                </div>
                            </div>

                            <div class="responsibility-item">
                                <div class="responsibility-icon">4</div>
                                <div class="responsibility-content">
                                    <strong>Report hazards</strong> to your supervisor
                                </div>
                            </div>

                            <div class="responsibility-item">
                                <div class="responsibility-icon">5</div>
                                <div class="responsibility-content">
                                    <strong>Follow safe work procedures</strong> designed to control risks
                                </div>
                            </div>

                            <div class="responsibility-item">
                                <div class="responsibility-icon">6</div>
                                <div class="responsibility-content">
                                    <strong>Monitor conditions</strong> throughout your shift for new hazards
                                </div>
                            </div>
                        </div>

                        <div class="alert alert-success mt-4">
                            <strong>Remember:</strong> Every time you operate a forklift, you're responsible for identifying hazards and managing risks to keep yourself and others safe.
                        </div>
                    </div>

                    <h3 class="text-primary fw-bold mb-4 mt-5">CHAPTER 2: YOUR DUTIES AS A WORKER</h3>

                    <p class="lead">Under Work Health and Safety (WHS) legislation in Australia, workers have legal duties. These duties apply to everyone in the workplace, regardless of their role or experience level.</p>

                    <div class="chapter-section mt-4">
                        <h4 class="text-primary fw-bold mb-4">Your Four Key Duties:</h4>

                        <div class="duty-card mb-4">
                            <div class="duty-header">
                                <div class="duty-badge">1</div>
                                <h5 class="mb-0">Take Reasonable Care for Your Own Health and Safety</h5>
                            </div>
                            <div class="duty-body">
                                <p class="mb-3"><strong>This means you must:</strong></p>
                                <ul class="duty-checklist">
                                    <li>Follow all safe work procedures and instructions</li>
                                    <li>Use equipment correctly and as intended</li>
                                    <li>Wear required personal protective equipment (PPE)</li>
                                    <li>Not take unnecessary risks or shortcuts</li>
                                    <li>Stay alert and focused on your work</li>
                                    <li>Report when you're not fit for work (tired, unwell, affected by drugs/alcohol)</li>
                                    <li>Stop work if conditions become unsafe</li>
                                    <li>Participate in safety training when required</li>
                                </ul>
                                <div class="duty-example">
                                    <strong>Example:</strong> If you notice your forklift's brakes feel spongy, you have a duty to stop using it and report the problem immediately, not continue operating hoping it will be okay.
                                </div>
                            </div>
                        </div>

                        <div class="duty-card mb-4">
                            <div class="duty-header">
                                <div class="duty-badge">2</div>
                                <h5 class="mb-0">Take Reasonable Care for Others Who May Be Affected by Your Actions</h5>
                            </div>
                            <div class="duty-body">
                                <p class="mb-3"><strong>Your work affects other people, so you must:</strong></p>
                                <ul class="duty-checklist">
                                    <li>Warn others about hazards you identify</li>
                                    <li>Operate the forklift safely to protect pedestrians</li>
                                    <li>Not create risks that could harm other workers</li>
                                    <li>Help maintain a safe workplace</li>
                                    <li>Consider how your actions impact others</li>
                                    <li>Communicate your intentions clearly</li>
                                </ul>
                                <div class="duty-example">
                                    <strong>Example:</strong> If you're moving a large load that blocks your view, you must use a spotter or travel in reverse to ensure you don't hit someone you can't see.
                                </div>
                            </div>
                        </div>

                        <div class="duty-card mb-4">
                            <div class="duty-header">
                                <div class="duty-badge">3</div>
                                <h5 class="mb-0">Cooperate with Your Employer's WHS Requirements</h5>
                            </div>
                            <div class="duty-body">
                                <p class="mb-3"><strong>You must cooperate by:</strong></p>
                                <ul class="duty-checklist">
                                    <li>Following workplace policies and procedures</li>
                                    <li>Attending required training sessions</li>
                                    <li>Participating in safety meetings and toolbox talks</li>
                                    <li>Completing required documentation (logbooks, checklists)</li>
                                    <li>Using safety equipment provided</li>
                                    <li>Following supervisor instructions on safety matters</li>
                                    <li>Reporting incidents, near-misses, and hazards</li>
                                </ul>
                                <div class="duty-example">
                                    <strong>Example:</strong> If your employer requires you to complete a pre-start checklist before operating the forklift each day, you must do so - you can't skip it because you're in a hurry.
                                </div>
                            </div>
                        </div>

                        <div class="duty-card mb-4">
                            <div class="duty-header">
                                <div class="duty-badge">4</div>
                                <h5 class="mb-0">Not Interfere With or Misuse Safety Equipment</h5>
                            </div>
                            <div class="duty-body">
                                <p class="mb-3"><strong>You must NEVER:</strong></p>
                                <ul class="duty-checklist danger-list">
                                    <li>Remove or disable safety guards on equipment</li>
                                    <li>Tamper with safety devices</li>
                                    <li>Misuse or damage PPE</li>
                                    <li>Deliberately create hazards</li>
                                    <li>Ignore or bypass safety systems</li>
                                    <li>Damage or interfere with safety equipment</li>
                                </ul>
                                <div class="duty-example">
                                    <strong>Example:</strong> Never remove the overhead guard from a forklift because it makes it easier to get on and off. That guard is there to protect you from falling objects and removing it is illegal.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chapter-section mt-5">
                        <h4 class="text-primary fw-bold mb-3">These Duties Are Legally Enforceable</h4>

                        <div class="alert alert-danger">
                            <h6 class="fw-bold">‚ö†Ô∏è Important Legal Information</h6>
                            <p>These duties aren't just guidelines - they're legal requirements under WHS legislation. If you breach these duties and someone is harmed, you can face:</p>
                            <ul class="mb-0">
                                <li>Criminal charges</li>
                                <li>Heavy fines</li>
                                <li>Imprisonment in serious cases</li>
                                <li>Loss of your licence</li>
                                <li>Civil liability for damages</li>
                            </ul>
                        </div>
                    </div>

                    <div class="chapter-section mt-4">
                        <h4 class="text-primary fw-bold mb-3">Taking Your Duties Seriously</h4>

                        <div class="key-message-box">
                            <div class="key-message-icon">üí°</div>
                            <div class="key-message-content">
                                <p class="mb-0">Every day when you arrive at work, remember that safety is not just your employer's responsibility - it's yours too. By meeting these four duties, you protect yourself, your colleagues, and your career.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- High Risk Work and WHS Legislation Section -->
            <div class="content-section mb-4">
                <div class="section-header section-header-teal">
                    <span>‚öñÔ∏è HIGH RISK WORK & WHS LEGISLATION</span>
                </div>

                <div class="lesson-content">
                    <h3 class="text-primary fw-bold mb-3">1.1.3 HIGH RISK WORK AND WHS LEGISLATION</h3>

                    <div class="alert alert-info">
                        <strong>Training Requirements:</strong> Anyone undertaking training for a High Risk Work (HRW) licence under Work Health & Safety (WHS) regulations must be:
                        <ul class="mt-2 mb-0">
                            <li>Currently enrolled in a HRW training course</li>
                            <li>Supervised at the workplace by someone holding a current HRW licence</li>
                        </ul>
                    </div>

                    <p>During your training, you will learn everything necessary to work safely and efficiently. After completing training and assessment, you can apply for your HRW licence.</p>

                    <h4 class="text-primary fw-bold mt-4 mb-3">1.1.4 MAKING THE APPLICATION</h4>

                    <p>Under WHS legislation, all HRW licence applicants must provide:</p>

                    <div class="bg-light p-3 rounded mb-3">
                        <h6 class="fw-bold">Required Documentation:</h6>
                        <ul>
                            <li>Full name</li>
                            <li>Evidence of identity (driver's licence or passport)</li>
                            <li>Passport-sized photograph (for your HRW photo licence)</li>
                            <li>Statement of attainment showing successful completion and assessment for the relevant unit of competency</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning">
                        <h6 class="fw-bold">‚ö†Ô∏è Important Declaration Requirements:</h6>
                        <p class="mb-2">Applicants must declare:</p>
                        <ul class="mb-0">
                            <li>That they do not hold an equivalent HRW licence from another WHS regulator</li>
                            <li>Any convictions under the WHS Act or regulations in Australia</li>
                            <li>Any enforceable undertakings under the WHS Act or regulations</li>
                            <li>Any previous HRW licence refusals, suspensions, or cancellations</li>
                        </ul>
                        <p class="mt-2 mb-0"><strong>Warning:</strong> Providing false or misleading information is strictly prohibited.</p>
                    </div>

                    <div class="alert alert-success">
                        <strong>‚è∞ Application Timeline:</strong> Applications must be submitted within <strong>60 days</strong> of receiving your statement of attainment or notice of satisfactory assessment.
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Licence Holder Responsibilities</h5>

                    <p>HRW licence holders must take reasonable care to not adversely affect the health and safety of others while performing high risk work.</p>

                    <div class="alert alert-danger">
                        <h6 class="fw-bold">‚ö†Ô∏è Penalties for Unsafe Work:</h6>
                        <p class="mb-1">Failing to work safely can result in:</p>
                        <ol class="mb-0">
                            <li>Licence suspension or cancellation</li>
                            <li>Refusal to renew licence (licences must be renewed every 5 years)</li>
                        </ol>
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Employer/PCBU Obligations</h5>

                    <p>Under WHS regulations, employers and PCBUs (Person Conducting a Business or Undertaking) <strong>must not</strong> allow anyone to conduct high risk work unless they:</p>
                    <ul>
                        <li>Hold a current HRW licence and are competent, <strong>OR</strong></li>
                        <li>Are enrolled in HRW training and supervised by a current HRW licence holder</li>
                    </ul>

                    <div class="alert alert-warning">
                        <strong>Important:</strong> If a licence holder is no longer competent to carry out the work, they must:
                        <ul class="mb-0 mt-2">
                            <li>Stop performing that work immediately</li>
                            <li>Retrain to regain full competency, <strong>OR</strong></li>
                            <li>Return their HRW licence to the regulator</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Plan Work Section -->
            <div class="content-section mb-4">
                <div class="section-header section-header-teal">
                    <span>üìã PLAN WORK</span>
                </div>

                <div class="lesson-content">
                    <h3 class="text-primary fw-bold mb-3">1.2 PLAN WORK</h3>

                    <p>It is important that you are aware of the requirements relating to your work. Before you begin your tasks, ensure that you access the relevant documentation and plan your work.</p>

                    <div class="alert alert-info">
                        <h6 class="fw-bold">Requirements relating to your work may include:</h6>
                        <ul class="mb-0">
                            <li>OHS/WHS requirements</li>
                            <li>Duty of care</li>
                            <li>Safe work practices</li>
                            <li>Safe Work Method Statements (SWMS)</li>
                        </ul>
                    </div>

                    <h4 class="text-primary fw-bold mt-5 mb-3">1.2.1 OCCUPATIONAL HEALTH & SAFETY/WORK HEALTH & SAFETY REQUIREMENTS</h4>

                    <p class="lead">Occupational Health & Safety/Work Health & Safety (OHS/WHS) is defined as laws and guidelines to help keep your workplace safe.</p>

                    <p class="fw-bold mt-4">These can be broken down into four main types:</p>

                    <div class="row mt-4">
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-primary">
                                <div class="card-header bg-primary text-white">
                                    <strong>Acts</strong>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">Laws to protect the health, safety and welfare of people at work.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-info">
                                <div class="card-header bg-info text-white">
                                    <strong>Regulations</strong>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">Gives more details or information on particular parts of the Act.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-success">
                                <div class="card-header bg-success text-white">
                                    <strong>Codes of Practice</strong>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">Are practical instructions on how to meet the terms of the Law.</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card h-100 border-warning">
                                <div class="card-header bg-warning text-dark">
                                    <strong>Australian Standards</strong>
                                </div>
                                <div class="card-body">
                                    <p class="mb-0">Give you the minimum levels of performance or quality for a hazard, work process or product.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h5 class="text-primary fw-bold mt-5 mb-3">1.2.1.1 HARMONISATION OF WORK HEALTH & SAFETY LEGISLATION</h5>

                    <p>In response to industry calls for greater national consistency, the Commonwealth, states and territories have agreed to implement nationally harmonised Work Health & Safety (WHS) legislation to commence on 1 January 2012.</p>

                    <p>While not all states and territories have actually implemented the model WHS legislation as of the start of 2012, it is important to be aware of these changes, as all states and territories will eventually implement them.</p>

                    <div class="alert alert-success">
                        <strong>Harmonisation Objective:</strong> To develop consistent, reasonable and effective safety standards and protections for all Australian workers through uniform WHS laws, regulations and codes of practice.
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Key Duties of Care</h5>

                    <div class="duty-of-care-section p-4 bg-light rounded">
                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="duty-number">1</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0">There is a primary duty of care requiring <strong>persons conducting a business or undertaking (PCBU)</strong> to ensure, so far as is <strong>reasonably practicable</strong>, the health and safety of <strong>workers</strong> and others who may be affected by the carrying out of work.</p>
                            </div>
                        </div>

                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="duty-number">2</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0">A requirement that <strong>officers</strong> of corporations and unincorporated bodies exercise <strong>due diligence</strong> to ensure compliance.</p>
                            </div>
                        </div>

                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="duty-number">3</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Workers</strong> must exercise reasonable care that their acts or omissions do not adversely affect the health and safety of persons at a workplace.</p>
                            </div>
                        </div>
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Key Elements Of The Work Health & Safety Legislation</h5>
                    <p>The following key elements of the WHS legislation will impact the way you do your job, and the responsibilities of your workplace.</p>

                    <h4 class="text-primary fw-bold mt-5 mb-3">1.2.3 SAFE WORK PRACTICES</h4>

                    <p class="lead">Safe work practices are methods that must be implemented to ensure a job is carried out as safely as possible.</p>

                    <div class="alert alert-info">
                        <h6 class="fw-bold">Safe work practices include:</h6>
                        <ul class="mb-0">
                            <li>Day-to-day observation of OHS/WHS policies and procedures</li>
                            <li>Emergency procedures</li>
                            <li>Risk assessment</li>
                            <li>Use of basic fire-fighting equipment</li>
                        </ul>
                    </div>

                    <div class="alert alert-warning mt-3">
                        <p class="mb-0"><strong>Important:</strong> Safe work practices are governed by legislative requirements and workplace procedures.</p>
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Key Safe Work Practice Areas</h5>

                    <div class="row mt-3">
                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">üö´</div>
                                <h6 class="fw-bold">Drugs and Alcohol</h6>
                                <p class="small mb-0">Strict policies regarding drug and alcohol use at work to maintain safety.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">üö∞</div>
                                <h6 class="fw-bold">Site Amenities</h6>
                                <p class="small mb-0">Access to essential facilities such as drinking water and toilets.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">‚öôÔ∏è</div>
                                <h6 class="fw-bold">Plant & Equipment</h6>
                                <p class="small mb-0">General requirements for safe use of plant and equipment.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">ü¶∫</div>
                                <h6 class="fw-bold">PPE & Clothing</h6>
                                <p class="small mb-0">Requirements for use of personal protective equipment and clothing.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">üö≠</div>
                                <h6 class="fw-bold">Smoking Areas</h6>
                                <p class="small mb-0">Smoking permitted only in designated areas to prevent fire hazards.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">üßπ</div>
                                <h6 class="fw-bold">Housekeeping</h6>
                                <p class="small mb-0">Maintaining a clean, tidy and safe work area at all times.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">ü§ù</div>
                                <h6 class="fw-bold">Workplace Respect</h6>
                                <p class="small mb-0">Preventing bullying and harassment in the workplace.</p>
                            </div>
                        </div>

                        <div class="col-md-6 mb-3">
                            <div class="safe-practice-card">
                                <div class="practice-icon">üóëÔ∏è</div>
                                <h6 class="fw-bold">Debris Management</h6>
                                <p class="small mb-0">Proper storage and removal of debris to maintain safety.</p>
                            </div>
                        </div>
                    </div>

                    <h4 class="text-primary fw-bold mt-5 mb-3">1.2.4 SAFE WORK METHOD STATEMENTS</h4>

                    <p class="lead">A Safe Work Method Statement (SWMS) details how specific hazards and risks related to the task being completed will be managed. It is developed by the employer/PCBU for their employees/workers.</p>

                    <h5 class="text-primary fw-bold mt-4 mb-3">SWMS Objectives</h5>

                    <div class="alert alert-info">
                        <p class="mb-2"><strong>SWMS fulfill a number of objectives:</strong></p>
                        <ul class="mb-0">
                            <li>Outline a safe method of work for a specific job</li>
                            <li>Provide an induction document that workers must read and understand before starting</li>
                            <li>Assist in meeting legal responsibilities for risk management, hazard identification, risk assessment, and risk control</li>
                            <li>Effectively coordinate work, materials, time, and people to achieve safe and efficient outcomes</li>
                            <li>Serve as a quality assurance tool</li>
                        </ul>
                    </div>

                    <h5 class="text-primary fw-bold mt-4 mb-3">Completing a SWMS</h5>

                    <div class="swms-steps-section p-4 bg-light rounded">
                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="swms-step-number">1</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Break down the job</strong> into logical steps, taking into consideration what is required to be achieved by the task.</p>
                            </div>
                        </div>

                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="swms-step-number">2</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Identify hazards</strong> for each step - the ways that a person or plant could be injured, harmed, or damaged during each step.</p>
                            </div>
                        </div>

                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="swms-step-number">3</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Decide on control measures</strong> required to mitigate hazards - what could be done to make the job safer and prevent injuries or harm.</p>
                            </div>
                        </div>

                        <div class="row align-items-center mb-4">
                            <div class="col-md-2 text-center">
                                <div class="swms-step-number">4</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Identify roles and responsibilities</strong> for actions and outcomes to ensure risk controls are carried out and supervision occurs.</p>
                            </div>
                        </div>

                        <div class="row align-items-center">
                            <div class="col-md-2 text-center">
                                <div class="swms-step-number">5</div>
                            </div>
                            <div class="col-md-10">
                                <p class="mb-0"><strong>Ensure understanding</strong> - All workers must fully understand the SWMS prior to commencing the task.</p>
                            </div>
                        </div>
                    </div>

                    <div class="alert alert-warning mt-4">
                        <h6 class="fw-bold">‚ö†Ô∏è Important Requirements:</h6>
                        <ul class="mb-0">
                            <li>The SWMS must be <strong>available for inspection at any given time</strong></li>
                            <li>It must be <strong>reviewed each year</strong> and amended if necessary</li>
                            <li>SWMS may also be referred to as <strong>Safe Work Procedures (SWP)</strong> or <strong>Job Safety Analysis (JSA)</strong></li>
                        </ul>
                    </div>
                </div>
            </div>
        }

        <!-- Lesson Content -->
        <div class="content-section mb-4">
            <div class="section-header section-header-teal">
                <span>üìñ LESSON CONTENT</span>
            </div>

            <div class="lesson-content">
                @if (!string.IsNullOrEmpty(lesson.Content))
                {
                    @((MarkupString)lesson.Content)
                }
                else
                {
                    <p class="text-muted fst-italic">No content available for this lesson.</p>
                }
            </div>
        </div>

        <!-- Enhanced Interactive 3D Forklift with Clickable Parts -->
        @if (lesson.Title != null && lesson.Title.ToLower().Contains("forklift"))
        {
            <div class="content-section mb-4">
                <div class="section-header section-header-primary">
                    <span>üöõ INTERACTIVE 3D FORKLIFT MODEL</span>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card border-primary">
                            <div class="card-body p-0 position-relative" style="overflow: hidden; border-radius: 8px;">
                                <div id="model-viewer-container" style="width: 100%; height: 500px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center;">
                                    <model-viewer
                                        id="forklift-model"
                                        src="/models/forklift/FWS_Forklift_01_Blue.gltf"
                                        alt="Interactive Blue Forklift 3D Model"
                                        auto-rotate="true"
                                        camera-controls="true"
                                        environment-image="neutral"
                                        style="width: 100%; height: 100%;">

                                        <!-- Clickable Hotspots -->
                                        <button class="hotspot" slot="hotspot-1" data-position="0.5m 0.2m 0m" data-normal="0m 1m 0m" @onclick='() => ShowPartInfo("forks")'>
                                            <div class="annotation">üîß Forks</div>
                                        </button>

                                        <button class="hotspot" slot="hotspot-2" data-position="0m 0.8m 0m" data-normal="0m 1m 0m" @onclick='() => ShowPartInfo("mast")'>
                                            <div class="annotation">üìè Mast</div>
                                        </button>

                                        <button class="hotspot" slot="hotspot-3" data-position="0m 0.5m -0.3m" data-normal="0m 0m -1m" @onclick='() => ShowPartInfo("controls")'>
                                            <div class="annotation">üéÆ Controls</div>
                                        </button>

                                        <button class="hotspot" slot="hotspot-4" data-position="0.4m 0m 0.4m" data-normal="0m -1m 0m" @onclick='() => ShowPartInfo("wheels")'>
                                            <div class="annotation">üõû Wheels</div>
                                        </button>

                                        <button class="hotspot" slot="hotspot-5" data-position="0m 0.3m 0m" data-normal="0m 0m 1m" @onclick='() => ShowPartInfo("body")'>
                                            <div class="annotation">üèóÔ∏è Body</div>
                                        </button>
                                    </model-viewer>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="card border-success">
                            <div class="card-header bg-success text-white">
                                <h6 class="mb-0">üìö Part Information</h6>
                            </div>
                            <div class="card-body">
                                @if (selectedPartInfo != null)
                                {
                                    <div class="part-info-panel">
                                        <h5 class="text-primary">@selectedPartInfo.Name</h5>
                                        <p class="text-muted">@selectedPartInfo.Description</p>

                                        <div class="safety-info bg-warning-subtle p-3 rounded mb-3">
                                            <h6 class="text-warning">‚ö†Ô∏è Safety Information</h6>
                                            <p class="mb-0 small">@selectedPartInfo.SafetyInfo</p>
                                        </div>

                                        <div class="operation-info bg-info-subtle p-3 rounded">
                                            <h6 class="text-info">üîß Operation</h6>
                                            <p class="mb-0 small">@selectedPartInfo.OperationInfo</p>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center text-muted">
                                        <div class="fs-1 mb-3">üñ±Ô∏è</div>
                                        <p><strong>Click on the colored buttons</strong> on the 3D model to learn about each forklift part!</p>
                                        <div class="mt-3">
                                            <small class="text-info">üí° You can rotate and zoom the model with your mouse</small>
                                        </div>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Footer Actions -->
        <div class="action-footer">
            <button class="btn btn-secondary" @onclick="GoBack">
                ‚Üê Back to My Learning
            </button>

            <button class="btn btn-success"
                    disabled="@(isCompleted || isMarkingComplete)"
                    @onclick="MarkAsComplete">
                @if (isMarkingComplete)
                {
                    <span class="spinner-border spinner-border-sm me-1"></span>
                }
                @(isCompleted ? "‚úì Already Completed" : "‚úì Mark as Complete")
            </button>
        </div>
    </div>
}

<style>
    .lesson-header {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        color: white;
    }

    .lesson-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 1rem;
    }

    .badge-container {
        background: white;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .time-icon {
        font-size: 1.1rem;
        color: #FF9800;
    }

    .duration-text {
        font-size: 0.9rem;
        font-weight: 600;
        color: #F57C00;
    }

    .completed-badge {
        background: #4CAF50;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15);
        color: white;
        font-weight: bold;
        font-size: 0.9rem;
    }

    .media-section, .content-section {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .section-header {
        padding: 0.75rem 1rem;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: bold;
        color: white;
        margin-bottom: 1rem;
        display: inline-block;
    }

    .section-header-purple {
        background: #9C27B0;
    }

    .section-header-teal {
        background: #00897B;
    }

    .slideshow-container {
        background: #f5f5f5;
        border-radius: 8px;
        padding: 1rem;
    }

    .image-display {
        background: white;
        border-radius: 4px;
        border: 1px solid #ddd;
        padding: 1rem;
        min-height: 350px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .image-display img {
        max-height: 350px;
        object-fit: contain;
    }

    .slideshow-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .btn-nav {
        background: #2196F3;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        font-weight: 600;
        transition: background 0.2s;
    }

    .btn-nav:hover:not(:disabled) {
        background: #1976D2;
    }

    .btn-nav:disabled {
        background: #BDBDBD;
        color: #757575;
        cursor: not-allowed;
    }

    .image-counter {
        color: #666;
        font-size: 0.9rem;
    }

    .image-caption {
        color: #666;
        font-style: italic;
        font-size: 0.9rem;
        margin-top: 0.5rem;
    }

    .lesson-content {
        font-size: 1rem;
        line-height: 1.7;
        color: #222;
    }

    .action-footer {
        background: white;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
    }

    .btn-secondary {
        background: #757575;
        border: none;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: background 0.2s;
    }

    .btn-secondary:hover {
        background: #616161;
    }

    .btn-success {
        background: #4CAF50;
        border: none;
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        transition: background 0.2s;
    }

    .btn-success:hover:not(:disabled) {
        background: #388E3C;
    }

    .btn-success:disabled {
        background: #BDBDBD;
        color: #757575;
    }

    /* 3D Model Styles */
    .section-header-primary {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        font-weight: bold;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(33, 150, 243, 0.3);
    }

    model-viewer {
        border-radius: 8px;
        box-shadow: inset 0 0 50px rgba(0,0,0,0.1);
        width: 100% !important;
        height: 500px !important;
        display: block !important;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        --progress-bar-height: 5px;
        --progress-bar-color: #4CAF50;
    }

    model-viewer::part(default-slot) {
        background: inherit;
    }

    .card {
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        border-radius: 12px;
        transition: transform 0.3s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }

    .part-info-panel {
        opacity: 1;
    }

    /* Hotspot Styles */
    .hotspot {
        display: block;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: none;
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
    }

    .hotspot:hover {
        background: rgba(33, 150, 243, 0.95);
        transform: scale(1.2);
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.5);
    }

    .hotspot .annotation {
        font-size: 14px;
        font-weight: bold;
        color: #2196F3;
        white-space: nowrap;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        pointer-events: none;
    }

    .hotspot:hover .annotation {
        color: white;
    }

    /* Duty of Care Number Circles */
    .duty-number {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #0066b2 0%, #004d8a 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
        color: #ffa500;
        box-shadow: 0 4px 10px rgba(0, 102, 178, 0.3);
        margin: 0 auto;
    }

    .duty-of-care-section {
        border-left: 4px solid #0066b2;
    }

    /* SWMS Step Number Circles */
    .swms-step-number {
        width: 80px;
        height: 80px;
        background: linear-gradient(135deg, #0066b2 0%, #004d8a 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
        color: #ffa500;
        box-shadow: 0 4px 10px rgba(0, 102, 178, 0.3);
        margin: 0 auto;
    }

    .swms-steps-section {
        border-left: 4px solid #0066b2;
    }

    /* Safe Work Practice Cards */
    .safe-practice-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        padding: 1.5rem;
        text-align: center;
        transition: all 0.3s ease;
        height: 100%;
    }

    .safe-practice-card:hover {
        border-color: #2196F3;
        box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        transform: translateY(-3px);
    }

    .practice-icon {
        font-size: 3rem;
        margin-bottom: 0.75rem;
    }

    /* Table of Contents Styles */
    .section-header-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        font-weight: bold;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
    }

    .toc-container {
        background: #f8f9fa;
        padding: 2rem;
        border-radius: 12px;
        border: 2px solid #e0e0e0;
    }

    .toc-part {
        background: white;
        margin-bottom: 1.5rem;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .toc-part:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transform: translateY(-2px);
    }

    .toc-part:last-child {
        margin-bottom: 0;
    }

    .toc-part-header {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
        padding: 1rem 1.5rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .toc-appendix .toc-part-header {
        background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
    }

    .part-number {
        font-weight: 900;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.2);
        padding: 0.4rem 0.8rem;
        border-radius: 4px;
        white-space: nowrap;
    }

    .part-title {
        font-weight: 600;
        font-size: 1.1rem;
        letter-spacing: 0.5px;
    }

    .toc-chapters {
        padding: 1rem 1.5rem;
    }

    .toc-chapter {
        padding: 0.75rem 1rem;
        margin: 0.5rem 0;
        background: #f8f9fa;
        border-left: 4px solid #2196F3;
        border-radius: 4px;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .toc-chapter:hover {
        background: #e3f2fd;
        border-left-color: #1976D2;
        transform: translateX(5px);
        box-shadow: 0 2px 4px rgba(33, 150, 243, 0.2);
    }

    .toc-chapter:first-child {
        margin-top: 0;
    }

    .toc-chapter:last-child {
        margin-bottom: 0;
    }

    /* Chapter Content Styles */
    .section-header-part {
        background: linear-gradient(135deg, #FF5722 0%, #E64A19 100%);
        color: white;
        padding: 1rem;
        border-radius: 8px;
        font-weight: bold;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(255, 87, 34, 0.3);
    }

    .chapter-section {
        margin-bottom: 2rem;
    }

    .hazard-list {
        list-style: none;
        padding-left: 0;
    }

    .hazard-list li {
        padding: 0.5rem 0;
        padding-left: 1.5rem;
        position: relative;
    }

    .hazard-list li::before {
        content: "‚ö†Ô∏è";
        position: absolute;
        left: 0;
        font-size: 1rem;
    }

    .risk-factors {
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        border-left: 4px solid #FF9800;
    }

    .risk-factor-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: white;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    }

    .risk-number {
        width: 50px;
        height: 50px;
        background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        font-weight: bold;
        color: white;
        flex-shrink: 0;
    }

    .concept-comparison {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: 2px solid #2196F3;
    }

    .concept-box {
        background: white;
        border: 2px solid #e0e0e0;
        transition: all 0.3s ease;
    }

    .hazard-box {
        border-color: #FF5722;
    }

    .hazard-box h6 {
        color: #FF5722;
    }

    .risk-box {
        border-color: #FF9800;
    }

    .risk-box h6 {
        color: #FF9800;
    }

    .concept-box:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .responsibility-list {
        background: #f8f9fa;
        padding: 1.5rem;
        border-radius: 8px;
        border-left: 4px solid #4CAF50;
    }

    .responsibility-item {
        display: flex;
        align-items: flex-start;
        gap: 1rem;
        padding: 1rem;
        margin-bottom: 1rem;
        background: white;
        border-radius: 6px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        transition: all 0.2s ease;
    }

    .responsibility-item:hover {
        box-shadow: 0 4px 8px rgba(76, 175, 80, 0.2);
        transform: translateX(5px);
    }

    .responsibility-item:last-child {
        margin-bottom: 0;
    }

    .responsibility-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #4CAF50 0%, #388E3C 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        font-weight: bold;
        color: white;
        flex-shrink: 0;
    }

    .responsibility-content {
        flex: 1;
        padding-top: 0.5rem;
    }

    /* Worker Duties Styles */
    .duty-card {
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
    }

    .duty-card:hover {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        transform: translateY(-3px);
        border-color: #2196F3;
    }

    .duty-header {
        background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        color: white;
        padding: 1.25rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .duty-badge {
        width: 50px;
        height: 50px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.75rem;
        font-weight: bold;
        flex-shrink: 0;
        border: 3px solid white;
    }

    .duty-body {
        padding: 1.5rem;
    }

    .duty-checklist {
        list-style: none;
        padding-left: 0;
    }

    .duty-checklist li {
        padding: 0.5rem 0;
        padding-left: 2rem;
        position: relative;
    }

    .duty-checklist li::before {
        content: "‚úì";
        position: absolute;
        left: 0;
        color: #4CAF50;
        font-weight: bold;
        font-size: 1.2rem;
    }

    .duty-checklist.danger-list li::before {
        content: "‚úó";
        color: #f44336;
    }

    .duty-example {
        margin-top: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
        border-left: 4px solid #FF9800;
        border-radius: 6px;
        font-size: 0.95rem;
    }

    .key-message-box {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
        border: 2px solid #4CAF50;
        border-radius: 10px;
        padding: 1.5rem;
        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
    }

    .key-message-icon {
        font-size: 3rem;
        flex-shrink: 0;
    }

    .key-message-content {
        flex: 1;
        font-size: 1.05rem;
        line-height: 1.6;
    }
</style>

@code {
    [Parameter]
    public string LessonId { get; set; } = string.Empty;

    [SupplyParameterFromQuery(Name = "enrollmentId")]
    public string EnrollmentId { get; set; } = string.Empty;

    private Lesson? lesson;
    private Enrollment? enrollment;
    private List<LessonMedia> lessonMedia = new();
    private bool isCompleted;
    private bool isMarkingComplete;
    private int currentImageIndex = 0;

    // Interactive 3D Forklift Properties
    private ForkliftPartInfo? selectedPartInfo;

    // Forklift Part Information Class
    public class ForkliftPartInfo
    {
        public string Name { get; set; } = "";
        public string Description { get; set; } = "";
        public string SafetyInfo { get; set; } = "";
        public string OperationInfo { get; set; } = "";
    }

    // Part Information Database
    private Dictionary<string, ForkliftPartInfo> forkliftParts = new()
    {
        {
            "forks",
            new ForkliftPartInfo
            {
                Name = "üîß Forklift Forks",
                Description = "The primary load-bearing components that slide under pallets and materials for lifting.",
                SafetyInfo = "Always ensure forks are fully inserted under the load. Check for cracks or damage before use. Maximum capacity must not be exceeded.",
                OperationInfo = "Use lift/lower controls to position forks at ground level. Drive forward until forks are completely under the load. Lift slightly to secure the load before moving."
            }
        },
        {
            "mast",
            new ForkliftPartInfo
            {
                Name = "üìè Mast System",
                Description = "The vertical assembly that raises and lowers the forks. Consists of main mast and secondary mast for extended reach.",
                SafetyInfo = "Never exceed maximum lift height. Ensure overhead clearance. Be aware of mast tilt angles to prevent load spillage.",
                OperationInfo = "Use hydraulic controls to extend mast. Tilt forward to engage load, tilt back to secure during transport. Lower mast completely when not in use."
            }
        },
        {
            "controls",
            new ForkliftPartInfo
            {
                Name = "üéÆ Control System",
                Description = "Includes steering wheel, hydraulic levers, gear controls, and instrument panel for operating the forklift.",
                SafetyInfo = "Always maintain proper seating position. Keep hands on controls during operation. Know location of emergency stop.",
                OperationInfo = "Steering wheel controls direction. Hydraulic levers control mast and fork movement. Use gentle movements for precise control."
            }
        },
        {
            "wheels",
            new ForkliftPartInfo
            {
                Name = "üõû Wheel Assembly",
                Description = "Front wheels provide steering and support. Rear wheels are typically smaller and provide stability during turns.",
                SafetyInfo = "Check tire pressure and tread before operation. Ensure wheels are free of debris. Be aware of turning radius limitations.",
                OperationInfo = "Front wheels steer the forklift. Rear wheels pivot for tight turning radius. Drive slowly in tight spaces and when turning."
            }
        },
        {
            "body",
            new ForkliftPartInfo
            {
                Name = "üèóÔ∏è Forklift Body",
                Description = "The main chassis containing the engine, counterweight, operator compartment, and safety features.",
                SafetyInfo = "Always wear seatbelt if equipped. Check overhead guard for damage. Ensure counterweight is secure and undamaged.",
                OperationInfo = "Body houses engine and provides counterweight for load stability. Contains fuel tank, hydraulic reservoir, and electrical systems."
            }
        }
    };

    // Method to show part information
    private void ShowPartInfo(string partKey)
    {
        if (forkliftParts.ContainsKey(partKey))
        {
            selectedPartInfo = forkliftParts[partKey];
            StateHasChanged();
        }
    }

    protected override async Task OnInitializedAsync()
    {
        lesson = await DbContext.Lessons
            .FirstOrDefaultAsync(l => l.Id == LessonId);

        if (!string.IsNullOrEmpty(EnrollmentId))
        {
            enrollment = await DbContext.Enrollments
                .Include(e => e.LessonProgress)
                .FirstOrDefaultAsync(e => e.Id == EnrollmentId);

            if (enrollment != null)
            {
                isCompleted = enrollment.LessonProgress
                    .Any(lp => lp.LessonId == LessonId && lp.Completed);
            }
        }

        lessonMedia = await DbContext.LessonMedia
            .Where(lm => lm.LessonId == LessonId)
            .OrderBy(lm => lm.OrderIndex)
            .ToListAsync();
    }

    private void PreviousImage()
    {
        if (currentImageIndex > 0)
        {
            currentImageIndex--;
        }
    }

    private void NextImage()
    {
        if (currentImageIndex < lessonMedia.Count - 1)
        {
            currentImageIndex++;
        }
    }

    private async Task MarkAsComplete()
    {
        if (enrollment == null || isCompleted) return;

        isMarkingComplete = true;

        try
        {
            var lessonProgress = await DbContext.LessonProgress
                .FirstOrDefaultAsync(lp => lp.LessonId == LessonId && lp.EnrollmentId == enrollment.Id);

            if (lessonProgress == null)
            {
                lessonProgress = new LessonProgress
                    {
                        LessonId = LessonId,
                        EnrollmentId = enrollment.Id,
                        Completed = true,
                        CompletedAt = DateTime.UtcNow
                    };
                DbContext.LessonProgress.Add(lessonProgress);
            }
            else
            {
                lessonProgress.Completed = true;
                lessonProgress.CompletedAt = DateTime.UtcNow;
                lessonProgress.UpdatedAt = DateTime.UtcNow;
            }

            await DbContext.SaveChangesAsync();
            isCompleted = true;
        }
        finally
        {
            isMarkingComplete = false;
        }
    }

    private void GoBack()
    {
        Navigation.NavigateTo("/my-learning");
    }
}
